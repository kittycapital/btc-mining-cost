<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>비트코인 채굴 원가</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scrollbar-width:none}
html::-webkit-scrollbar{display:none}
body{background:#000;color:#e4e4e7;font-family:'Noto Sans KR',sans-serif;min-height:100vh}

/* Nav */
.top-nav{position:sticky;top:0;z-index:100;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);border-bottom:1px solid #1a1a1a;padding:0 16px;display:flex;align-items:center;justify-content:center;height:56px}
.nav-title{font-family:'Plus Jakarta Sans',sans-serif;font-size:1.3rem;font-weight:600;color:#e4e4e7;white-space:nowrap}

/* Container */
.container{max-width:960px;margin:0 auto;padding:16px 12px 60px}

/* Header */
.header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;flex-wrap:wrap;gap:16px}
.title-sub{font-size:12px;color:#71717a;margin-top:4px}
.stats{display:flex;gap:10px;flex-wrap:wrap}
.stat-card{background:#0a0a0a;border:1px solid #1a1a1a;border-radius:10px;padding:14px 16px;text-align:right}
.stat-label{font-size:11px;color:#71717a;font-weight:500;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.05em}
.stat-value{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700}
.stat-value.price{color:#a1a1aa}
.stat-value.cost{color:#10b981}
.stat-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:rgba(16,185,129,0.6);margin-top:2px}

/* Card */
.card{background:#0a0a0a;border:1px solid #1a1a1a;border-radius:12px;padding:16px;margin-bottom:16px}

/* Chart */
.chart-wrapper{position:relative;height:480px}
.chart-wrapper canvas{width:100%!important;height:100%!important}

/* Watermark */
.watermark{position:relative}
.watermark::after{content:'Herdvibe.com';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'JetBrains Mono',monospace;font-size:28px;font-weight:600;color:rgba(255,255,255,0.06);pointer-events:none;z-index:2;letter-spacing:2px}

/* Legend */
.legend{display:flex;gap:20px;margin-bottom:14px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:8px;font-size:12px;color:#a1a1aa}
.legend-color{width:16px;height:3px;border-radius:2px}
.legend-color.price{background:#71717a}
.legend-band{width:16px;height:10px;border-radius:3px;background:linear-gradient(180deg,rgba(16,185,129,0.35),rgba(16,185,129,0.1))}

/* Share */
.share-bar{display:flex;gap:6px;justify-content:center;margin:12px 0 4px;flex-wrap:wrap}
.share-btn{display:flex;align-items:center;gap:5px;padding:6px 12px;border-radius:6px;border:1px solid #222;background:#0a0a0a;color:#a1a1aa;font-size:11px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s}
.share-btn:hover{border-color:#444;color:#e4e4e7}
.share-btn svg{width:14px;height:14px;flex-shrink:0}
.share-btn.twitter:hover{border-color:#1d9bf0;color:#1d9bf0}
.share-btn.kakao:hover{border-color:#fee500;color:#fee500}
.share-btn.telegram:hover{border-color:#26a5e4;color:#26a5e4}
.share-btn.instagram:hover{border-color:#e1306c;color:#e1306c}
.share-btn.instagram.copied{border-color:#22c55e;color:#22c55e}
.share-btn.copy:hover{border-color:#22c55e;color:#22c55e}
.share-btn.copied{border-color:#22c55e;color:#22c55e}

/* Toast */
.toast{position:fixed;bottom:20px;right:20px;background:#22c55e;color:#000;padding:10px 16px;border-radius:8px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transform:translateY(10px);transition:all 0.3s ease;pointer-events:none}
.toast.show{opacity:1;transform:translateY(0)}

.last-updated{text-align:center;font-size:11px;color:#52525b;margin-top:8px}
.loading{display:flex;align-items:center;justify-content:center;height:480px;color:#71717a;gap:8px;font-size:13px}
.spinner{width:18px;height:18px;border:2px solid #333;border-top-color:#a78bfa;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.error{text-align:center;padding:60px 20px;color:#ef4444;font-size:13px}

@media(max-width:640px){
  .top-nav{padding:0 10px;height:52px}
  .nav-title{font-size:1.1rem}
  .header{flex-direction:column}
  .stats{width:100%;justify-content:space-between}
  .stat-card{text-align:left;flex:1}
  .stat-value{font-size:16px}
  .chart-wrapper{height:380px}
  .loading{height:380px}
  .watermark::after{font-size:20px}
}
</style>
</head>
<body>

<nav class="top-nav">
    <div class="nav-title">비트코인 채굴 원가</div>
</nav>

<div class="container">
    <div class="header">
        <div>
            <div class="title-sub">Bitcoin Mining Cost vs Price · 2 Year</div>
        </div>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Bitcoin Price</div>
                <div class="stat-value price" id="btc-price">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Mining Cost</div>
                <div class="stat-value cost" id="mining-cost">--</div>
                <div class="stat-sub" id="mining-range"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="legend">
            <div class="legend-item"><div class="legend-color price"></div><span>BTC Price</span></div>
            <div class="legend-item"><div class="legend-band"></div><span>Mining Cost ($0.05–$0.07/kWh + HW Depreciation)</span></div>
        </div>
        <div class="chart-wrapper watermark" id="chart-wrapper">
            <div class="loading"><div class="spinner"></div>데이터 로딩 중...</div>
        </div>
        <!-- In-chart share -->
        <div class="share-bar" style="margin-top:14px">
            <button class="share-btn twitter" onclick="shareTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>트위터</button>
            <button class="share-btn kakao" onclick="shareKakao()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-5.52 0-10 3.36-10 7.5 0 2.66 1.74 5 4.36 6.33-.14.53-.9 3.4-.93 3.61 0 0-.02.17.09.23.11.07.24.03.24.03.32-.04 3.7-2.42 4.28-2.83.62.09 1.27.13 1.96.13 5.52 0 10-3.36 10-7.5S17.52 3 12 3z"/></svg>카카오톡</button>
            <button class="share-btn telegram" onclick="shareTelegram()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>텔레그램</button>
            <button class="share-btn instagram" onclick="shareInstagram(this)"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>인스타그램</button>
            <button class="share-btn copy" onclick="copyLink(this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>링크복사</button>
        </div>
    </div>

    <div class="last-updated" id="last-updated"></div>
</div>

<div class="toast" id="toast"></div>

<script>
const SHARE_URL = 'https://herdvibe.com/btc-mining-cost';
const SHARE_TITLE = '비트코인 채굴 원가 - Mining Cost vs Price';
const SHARE_DESC = '비트코인 채굴 원가와 시세 비교 차트 | Herdvibe';

// Toast
function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

// Share
function shareTwitter() {
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(SHARE_TITLE)}&url=${encodeURIComponent(SHARE_URL)}`, '_blank');
}
function shareKakao() {
    if (window.Kakao && !Kakao.isInitialized()) Kakao.init('a43ed7b39fac35458f4f9df925a279b5');
    if (window.Kakao) {
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: { title: SHARE_TITLE, description: SHARE_DESC, imageUrl: 'https://herdvibe.com/og-mining.png', link: { mobileWebUrl: SHARE_URL, webUrl: SHARE_URL } }
        });
    }
}
function shareTelegram() {
    window.open(`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(SHARE_TITLE)}`, '_blank');
}
function shareInstagram(btn) {
    try {
        if (window.parent !== window) { window.parent.postMessage({ type: 'copy', text: SHARE_URL }, '*'); }
        else { navigator.clipboard.writeText(SHARE_URL); }
        const orig = btn.innerHTML;
        btn.classList.add('copied');
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';
        showToast('링크가 복사되었습니다 - 인스타그램에 붙여넣기 하세요 ✓');
        setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = orig; }, 2000);
    } catch(e) { showToast('복사 실패'); }
}
function copyLink(btn) {
    try {
        if (window.parent !== window) { window.parent.postMessage({ type: 'copy', text: SHARE_URL }, '*'); }
        else { navigator.clipboard.writeText(SHARE_URL); }
        const orig = btn.innerHTML;
        btn.classList.add('copied');
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';
        showToast('링크가 복사되었습니다 ✓');
        setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = orig; }, 2000);
    } catch(e) { showToast('복사 실패'); }
}

// ===== CHART LOGIC =====
let chart = null;

function formatCurrency(value) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency', currency: 'USD',
        minimumFractionDigits: 0, maximumFractionDigits: 0
    }).format(value);
}

async function loadData() {
    try {
        const response = await fetch('data.json');
        if (!response.ok) throw new Error('Data not found');
        return await response.json();
    } catch (error) {
        console.error('Error loading data:', error);
        return null;
    }
}

function updateStats(data) {
    document.getElementById('btc-price').textContent = formatCurrency(data.current_price);
    document.getElementById('mining-cost').textContent = formatCurrency(data.current_cost_mid);
    document.getElementById('mining-range').textContent =
        formatCurrency(data.current_cost_low) + ' — ' + formatCurrency(data.current_cost_high);
}

function createBandGradient(ctx, chartArea) {
    const gradient = ctx.createLinearGradient(0, chartArea.top, 0, chartArea.bottom);
    gradient.addColorStop(0, 'rgba(16, 185, 129, 0.28)');
    gradient.addColorStop(0.5, 'rgba(16, 185, 129, 0.16)');
    gradient.addColorStop(1, 'rgba(16, 185, 129, 0.06)');
    return gradient;
}

function createChart(data) {
    const wrapper = document.getElementById('chart-wrapper');
    wrapper.innerHTML = '<canvas id="miningChart"></canvas>';
    const ctx = document.getElementById('miningChart').getContext('2d');
    const dates = data.dates.map(d => new Date(d));

    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: 'BTC Price',
                    data: data.btc_prices,
                    borderColor: '#71717a',
                    backgroundColor: 'transparent',
                    borderWidth: 2, tension: 0.1,
                    pointRadius: 0, pointHoverRadius: 4,
                    pointHoverBackgroundColor: '#71717a',
                    order: 1
                },
                {
                    label: 'Mining Cost High',
                    data: data.mining_cost_high,
                    borderColor: 'transparent', borderWidth: 0,
                    tension: 0.45, pointRadius: 0, pointHoverRadius: 0,
                    fill: '+1',
                    backgroundColor: function(context) {
                        const chart = context.chart;
                        const { ctx, chartArea } = chart;
                        if (!chartArea) return 'rgba(16, 185, 129, 0.15)';
                        return createBandGradient(ctx, chartArea);
                    },
                    order: 2
                },
                {
                    label: 'Mining Cost Low',
                    data: data.mining_cost_low,
                    borderColor: 'transparent', borderWidth: 0,
                    tension: 0.45, pointRadius: 0, pointHoverRadius: 0,
                    fill: false, order: 3
                }
            ]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#1a1a1a', borderColor: '#333', borderWidth: 1,
                    titleColor: '#e4e4e7', bodyColor: '#a1a1aa', padding: 12,
                    titleFont: { family: 'JetBrains Mono' },
                    bodyFont: { family: 'JetBrains Mono' },
                    displayColors: true,
                    filter: function(tooltipItem) {
                        return tooltipItem.datasetIndex === 0 || tooltipItem.datasetIndex === 1;
                    },
                    callbacks: {
                        title: function(context) {
                            const date = new Date(context[0].parsed.x);
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                        },
                        label: function(context) {
                            if (context.datasetIndex === 0) {
                                return 'BTC Price: ' + formatCurrency(context.raw);
                            } else if (context.datasetIndex === 1) {
                                const idx = context.dataIndex;
                                const low = context.chart.data.datasets[2].data[idx];
                                const high = context.raw;
                                return 'Mining Cost: ' + formatCurrency(low) + ' — ' + formatCurrency(high);
                            }
                            return null;
                        },
                        labelColor: function(context) {
                            if (context.datasetIndex === 0) return { borderColor: '#71717a', backgroundColor: '#71717a' };
                            return { borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.3)' };
                        }
                    }
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'month', displayFormats: { month: 'MMM yyyy' } },
                    grid: { color: '#1a1a1a' },
                    ticks: { color: '#71717a', font: { family: "'JetBrains Mono', monospace", size: 10 }, maxTicksLimit: 12 }
                },
                y: {
                    type: 'linear', position: 'left',
                    grid: { color: '#1a1a1a' },
                    ticks: {
                        color: '#71717a',
                        font: { family: "'JetBrains Mono', monospace", size: 10 },
                        callback: function(value) { return '$' + (value / 1000).toFixed(0) + 'k'; }
                    }
                }
            }
        }
    });
}

async function init() {
    const data = await loadData();
    if (!data || !data.dates || data.dates.length === 0) {
        document.getElementById('chart-wrapper').innerHTML =
            '<div class="error">데이터를 불러올 수 없습니다.</div>';
        return;
    }
    updateStats(data);
    createChart(data);
    if (data.last_updated) {
        document.getElementById('last-updated').textContent =
            'Last updated: ' + new Date(data.last_updated).toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });
    }
}

init();
</script>
</body>
</html>
